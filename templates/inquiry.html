{% extends "base.html" %}

{% block title %}(주)린코리아 - 게시판{% endblock %}

{% block content %}
<div class="max-w-7xl container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-4 md:mb-0">(주)린코리아 - 게시판</h1>
        <div class="flex space-x-2">
            <button id="hamburger-button" class="md:hidden bg-blue-500 text-white font-bold py-2 px-4 rounded shadow-lg transition duration-300">
                카테고리
            </button>
            <a href="{{ url_for('inquiry.new_post') }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg transition duration-300">새 게시물 작성</a>
        </div>
    </div>
    <!-- Category Tabs -->
    <div class="mb-6 md:hidden">
        <div id="hamburger-menu" class="hidden mt-2 bg-white rounded-lg shadow-lg">
            <ul class="flex flex-col">
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='공지사항') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '공지사항' %}bg-blue-100{% endif %}">공지사항</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='뉴스') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '뉴스' %}bg-blue-100{% endif %}">뉴스</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='건설자재사업부') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '건설자재사업부' %}bg-blue-100{% endif %}">건설자재사업부</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='건설기계사업부') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '건설기계사업부' %}bg-blue-100{% endif %}">건설기계사업부</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='시공문의') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '시공문의' %}bg-blue-100{% endif %}">시공문의</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='자재문의') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '자재문의' %}bg-blue-100{% endif %}">자재문의</a>
                </li>
                <li class="border-b">
                    <a href="{{ url_for('inquiry.inquiry_board', category='시공실적') }}" class="block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '시공실적' %}bg-blue-100{% endif %}">시공실적</a>
                </li>
            </ul>
        </div>
    </div>

    <hr class="border-gray-300 mb-6">

    <!-- 검색 폼 -->
    <form method="GET" action="{{ url_for('inquiry.inquiry_board') }}" class="mb-6 flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-2">
        <input type="text" id="search-input" name="q" placeholder="검색어를 입력하세요" class="border border-gray-300 rounded-lg py-2 px-4 w-full focus:outline-none focus:ring-2 focus:ring-blue-500" value="{{ request.args.get('q', '') }}">
    </form>

    <div class="hidden md:block mb-6 overflow-x-auto">
        <ul class="flex border-b">
            <li class="-mb-px mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='공지사항') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '공지사항' %}border-b-2 border-blue-500{% endif %}">공지사항</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='뉴스') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '뉴스' %}border-b-2 border-blue-500{% endif %}">뉴스</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='건설자재사업부') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '건설자재사업부' %}border-b-2 border-blue-500{% endif %}">건설자재사업부</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='건설기계사업부') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '건설기계사업부' %}border-b-2 border-blue-500{% endif %}">건설기계사업부</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='시공문의') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '시공문의' %}border-b-2 border-blue-500{% endif %}">시공문의</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='자재문의') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '자재문의' %}border-b-2 border-blue-500{% endif %}">자재문의</a>
            </li>
            <li class="mr-1">
                <a href="{{ url_for('inquiry.inquiry_board', category='시공실적') }}" class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold transition duration-300 {% if selected_category == '시공실적' %}border-b-2 border-blue-500{% endif %}">시공실적</a>
            </li>
        </ul>
    </div>

    <div class="space-y-4">
        {% for item in posts %}
            <a href="{{ url_for('inquiry.view_post', post_id=item.post.id) }}" class="block p-6 bg-white rounded-lg shadow-md hover:bg-gray-100 transition duration-300">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-2">
                    <div>
                        <h5 class="text-xl md:text-2xl font-semibold text-gray-800">{{ item.post.title }}</h5>
                        <small class="text-gray-500">작성자: {{ item.user.username }} | 작성일: {{ item.post.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
                    </div>
                    <div class="hidden md:flex flex-shrink-0 w-12 h-12 items-center justify-center bg-blue-500 text-white font-bold rounded-full shadow-md mt-4 md:mt-0">
                        {{ loop.revindex }}
                    </div>
                </div>
                <div class="mt-2 text-gray-600">
                    <span class="mr-4"><i class="fas fa-eye"></i> {{ item.post.views }} 조회수</span>
                    <span class="mr-4"><i class="fas fa-thumbs-up"></i> {{ item.post.likes|length }} 좋아요</span>
                    <span><i class="fas fa-comments"></i> {{ item.comment_count }} 댓글</span>
                </div>
            </a>
        {% else %}
            <p class="text-gray-500">게시물이 없습니다.</p>
        {% endfor %}
    </div>
    <div class="mt-8 flex justify-center space-x-2">
        {% if pagination.has_prev %}
            <a href="{{ url_for('inquiry.inquiry_board', page=pagination.prev_num, category=request.args.get('category')) }}" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition duration-300">이전</a>
        {% endif %}
        {% for page_num in pagination.iter_pages() %}
            {% if page_num %}
                {% if page_num == pagination.page %}
                    <span class="bg-blue-500 text-white font-bold py-2 px-4 rounded">{{ page_num }}</span>
                {% else %}
                    <a href="{{ url_for('inquiry.inquiry_board', page=page_num, category=request.args.get('category')) }}" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded transition duration-300">{{ page_num }}</a>
                {% endif %}
            {% else %}
                <span class="py-2 px-4">...</span>
            {% endif %}
        {% endfor %}
        {% if pagination.has_next %}
            <a href="{{ url_for('inquiry.inquiry_board', page=pagination.next_num, category=request.args.get('category')) }}" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition duration-300">다음</a>
        {% endif %}
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const hamburgerButton = document.getElementById('hamburger-button');
        const hamburgerMenu = document.getElementById('hamburger-menu');

        searchInput.addEventListener('input', function() {
            const query = searchInput.value;

            fetch(`{{ url_for('inquiry.inquiry_board') }}?q=${query}`)
                .then(response => response.text())
                .then(data => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data, 'text/html');
                    const newContent = doc.querySelector('.space-y-4').innerHTML;
                    document.querySelector('.space-y-4').innerHTML = newContent;
                })
                .catch(error => console.error('Error:', error));
        });

        hamburgerButton.addEventListener('click', function() {
            hamburgerMenu.classList.toggle('hidden');
        });
    });
</script>
{% endblock %}